<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tesouraria - Sistema de Gestão Financeira para Grupos de Oração</title>
  <meta name="description" content="Sistema completo de gestão financeira para grupos de oração. Controle de tesouraria, contribuições de membros, relatórios mensais e anuais." />
  <meta name="author" content="Tesouraria App" />
  <meta name="keywords" content="tesouraria, grupo de oração, gestão financeira, contribuições, relatórios" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root {
      --primary-50: #f0f9ff;
      --primary-100: #e0f2fe;
      --primary-200: #bae6fd;
      --primary-500: #0ea5e9;
      --primary-600: #0284c7;
      --primary-700: #0369a1;
      --primary-900: #0c4a6e;
      
      --success-50: #f0fdf4;
      --success-500: #22c55e;
      --success-600: #16a34a;
      
      --warning-50: #fefce8;
      --warning-500: #eab308;
      --warning-600: #ca8a04;
      
      --danger-50: #fef2f2;
      --danger-500: #ef4444;
      --danger-600: #dc2626;
      
      --neutral-50: #f8fafc;
      --neutral-100: #f1f5f9;
      --neutral-200: #e2e8f0;
      --neutral-300: #cbd5e1;
      --neutral-400: #94a3b8;
      --neutral-500: #64748b;
      --neutral-600: #475569;
      --neutral-700: #334155;
      --neutral-800: #1e293b;
      --neutral-900: #0f172a;
    }

    * {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--primary-50) 0%, var(--neutral-100) 100%);
      min-height: 100vh;
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card-elegant {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border: 1px solid var(--neutral-200);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-elegant:hover {
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      transform: translateY(-2px);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px 0 rgba(2, 132, 199, 0.3);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--primary-700), var(--primary-600));
      transform: translateY(-2px);
      box-shadow: 0 8px 25px 0 rgba(2, 132, 199, 0.4);
    }

    .btn-secondary {
      background: white;
      color: var(--primary-600);
      padding: 8px 16px;
      border-radius: 10px;
      font-weight: 600;
      border: 2px solid var(--primary-200);
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .btn-secondary:hover {
      background: var(--primary-50);
      border-color: var(--primary-300);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success-500), var(--success-600));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px 0 rgba(34, 197, 94, 0.3);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px 0 rgba(34, 197, 94, 0.4);
    }

    .btn-danger {
      color: var(--danger-500);
      background: var(--danger-50);
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 500;
      border: 1px solid var(--danger-200);
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-danger:hover {
      background: var(--danger-500);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning-500), var(--warning-600));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px 0 rgba(234, 179, 8, 0.3);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px 0 rgba(234, 179, 8, 0.4);
    }

    .input-elegant {
      padding: 12px 16px;
      border: 2px solid var(--neutral-200);
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
      width: 100%;
    }

    .input-elegant:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
    }

    .input-small {
      padding: 8px 12px;
      border: 2px solid var(--neutral-200);
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
    }

    .input-small:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }

    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.1);
      border-right: 1px solid var(--neutral-200);
    }

    .nav-item {
      color: var(--neutral-700);
      padding: 12px 20px;
      border-radius: 12px;
      margin: 4px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: var(--primary-50);
      color: var(--primary-700);
      transform: translateX(4px);
    }

    .nav-item.active {
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      color: white;
      box-shadow: 0 4px 14px 0 rgba(2, 132, 199, 0.3);
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      color: white;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(2, 132, 199, 0.3);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 100px;
      height: 100px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
    }

    .stat-card-success {
      background: linear-gradient(135deg, var(--success-500), var(--success-600));
      box-shadow: 0 8px 32px rgba(34, 197, 94, 0.3);
    }

    .stat-card-warning {
      background: linear-gradient(135deg, var(--warning-500), var(--warning-600));
      box-shadow: 0 8px 32px rgba(234, 179, 8, 0.3);
    }

    .stat-card-danger {
      background: linear-gradient(135deg, var(--danger-500), var(--danger-600));
      box-shadow: 0 8px 32px rgba(239, 68, 68, 0.3);
    }

    .table-elegant {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    .table-elegant table {
      width: 100%;
      min-width: 600px;
    }

    .table-elegant thead {
      background: var(--neutral-50);
    }

    .table-elegant th {
      padding: 16px;
      font-weight: 600;
      color: var(--neutral-700);
      border-bottom: 1px solid var(--neutral-200);
      text-align: left;
      white-space: nowrap;
    }

    .table-elegant td {
      padding: 16px;
      border-bottom: 1px solid var(--neutral-100);
      white-space: nowrap;
    }

    .table-elegant tbody tr:hover {
      background: var(--neutral-50);
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--neutral-900);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: slideInRight 0.3s ease-out;
      max-width: 350px;
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .mobile-header {
      display: none;
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      color: white;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }

    .mobile-menu {
      display: none;
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      padding: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .mobile-menu.active {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    @media (max-width: 1024px) {
      .sidebar { display: none; }
      .mobile-header { display: block; }
      .main-content { padding: 16px; }
      
      .grid-responsive {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }

    .logo-area {
      padding: 24px 20px;
      border-bottom: 1px solid var(--neutral-200);
      margin-bottom: 20px;
      text-align: center;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      align-items: end;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .badge-success {
      background: var(--success-100);
      color: var(--success-600);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-danger {
      background: var(--danger-50);
      color: var(--danger-600);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--neutral-200);
      border-top: 3px solid var(--primary-500);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsividade melhorada para mobile */
    @media (max-width: 768px) {
      .table-elegant {
        font-size: 14px;
      }
      
      .table-elegant th,
      .table-elegant td {
        padding: 12px 8px;
      }
      
      .input-elegant {
        font-size: 16px; /* Evita zoom no iOS */
      }
      
      .btn-primary,
      .btn-success,
      .btn-warning {
        padding: 14px 20px;
        font-size: 16px;
      }
      
      .stat-card {
        padding: 20px;
      }
      
      .card-elegant {
        margin: 0 4px;
      }
    }
  </style>
</head>
<body>

<div class="mobile-header">
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
        <i data-lucide="church" class="w-5 h-5"></i>
      </div>
      <div>
        <h1 class="text-lg font-bold">Tesouraria</h1>
        <p class="text-xs opacity-90">Grupo de Oração</p>
      </div>
    </div>
    <button id="mobileMenuToggle" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
      <i data-lucide="menu" class="w-5 h-5"></i>
    </button>
  </div>
</div>

<div id="mobileMenu" class="mobile-menu">
  <div class="space-y-2">
    <div class="nav-item mobile-nav" data-view="tesouraria">
      <i data-lucide="wallet" class="w-5 h-5"></i>
      <span>Tesouraria</span>
    </div>
    <div class="nav-item mobile-nav" data-view="membros">
      <i data-lucide="users" class="w-5 h-5"></i>
      <span>Membros</span>
    </div>
    <div class="nav-item mobile-nav" data-view="contabilidade">
      <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
      <span>Contabilidade</span>
    </div>
  </div>
</div>

<div class="flex min-h-screen">
  <aside class="sidebar">
    <div class="logo-area">
      <div class="w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mx-auto mb-3">
        <i data-lucide="church" class="w-7 h-7 text-white"></i>
      </div>
      <h1 class="text-xl font-bold text-gray-800">Tesouraria</h1>
      <p class="text-gray-600 text-sm">Grupo de Oração</p>
    </div>

    <nav class="flex-1">
      <div class="nav-item active" data-view="tesouraria">
        <i data-lucide="wallet" class="w-5 h-5"></i>
        <span>Tesouraria</span>
      </div>
      <div class="nav-item" data-view="membros">
        <i data-lucide="users" class="w-5 h-5"></i>
        <span>Membros</span>
      </div>
      <div class="nav-item" data-view="contabilidade">
        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
        <span>Contabilidade</span>
      </div>
    </nav>
  </aside>

  <main class="flex-1 main-content p-8">
    <div id="views">

      <!-- TESOURARIA -->
      <section id="tesouraria" class="space-y-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
            <i data-lucide="wallet" class="w-6 h-6 text-white"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Tesouraria</h1>
            <p class="text-gray-600">Gerencie as finanças do grupo</p>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card stat-card-success">
            <div class="flex items-center justify-between relative z-10">
              <div>
                <p class="text-green-100 text-sm font-medium">Entradas</p>
                <p class="text-3xl font-bold">R$ <span id="totalEntradas">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="trending-up" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card stat-card-warning">
            <div class="flex items-center justify-between relative z-10">
              <div>
                <p class="text-yellow-100 text-sm font-medium">Saídas</p>
                <p class="text-3xl font-bold">R$ <span id="totalSaidas">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="trending-down" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card" id="saldoCard">
            <div class="flex items-center justify-between relative z-10">
              <div>
                <p class="text-blue-100 text-sm font-medium">Saldo</p>
                <p class="text-3xl font-bold">R$ <span id="saldoAtual">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="piggy-bank" class="w-6 h-6"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="card-elegant p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="plus-circle" class="w-5 h-5 text-blue-600"></i>
            Nova Transação
          </h2>
          
          <form id="txForm" class="form-grid">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
              <select id="txType" class="input-elegant">
                <option value="entrada">📈 Entrada</option>
                <option value="saida">📉 Saída</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label>
              <input id="txDesc" placeholder="Digite a descrição..." class="input-elegant" required />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
              <input id="txValue" type="number" placeholder="0,00" step="0.01" min="0.01" class="input-elegant" required />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
              <input id="txDate" type="date" class="input-elegant" required />
            </div>

            <div style="grid-column: 1 / -1;">
              <button type="submit" class="btn-success w-full">
                <i data-lucide="save" class="w-4 h-4"></i>
                Salvar Transação
              </button>
            </div>
          </form>
        </div>

        <div class="card-elegant p-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
            <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-2">
              <i data-lucide="history" class="w-5 h-5 text-blue-600"></i>
              Histórico de Transações
            </h2>
            
            <div class="flex gap-3">
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Mês</label>
                <input id="selectedMonth" type="number" min="1" max="12" class="input-small w-20 text-center" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Ano</label>
                <input id="selectedYear" type="number" min="2023" max="2030" class="input-small w-24 text-center" />
              </div>
            </div>
          </div>
          
          <div class="table-elegant">
            <table>
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Tipo</th>
                  <th>Descrição</th>
                  <th style="text-align: right;">Valor</th>
                  <th style="text-align: center;">Ação</th>
                </tr>
              </thead>
              <tbody id="transactionsList">
                <tr>
                  <td colspan="5" style="padding: 32px; text-align: center; color: var(--neutral-500);">
                    <div class="flex flex-col items-center gap-2">
                      <div class="loading-spinner"></div>
                      <div>Carregando transações...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- MEMBROS -->
      <section id="membros" class="hidden space-y-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-blue-600 rounded-xl flex items-center justify-center">
            <i data-lucide="users" class="w-6 h-6 text-white"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Membros</h1>
            <p class="text-gray-600">Gerencie membros e contribuições</p>
          </div>
        </div>

        <div class="card-elegant p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="user-plus" class="w-5 h-5 text-blue-600"></i>
            Adicionar Membro
          </h2>
          
          <div class="flex flex-col md:flex-row gap-4">
            <input id="newMemberName" placeholder="Nome do novo membro..." class="input-elegant flex-1" />
            <button id="btnAddMember" class="btn-primary">
              <i data-lucide="plus" class="w-4 h-4"></i>
              Adicionar
            </button>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="flex items-center justify-between relative z-10">
              <div>
                <p class="text-blue-100 text-sm font-medium">Total de Membros</p>
                <p class="text-3xl font-bold"><span id="membersCount">0</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="users" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card stat-card-success">
            <div class="flex items-center justify-between relative z-10">
              <div>
                <p class="text-green-100 text-sm font-medium">Total RCC</p>
                <p class="text-3xl font-bold">R$ <span id="totalRcc">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="heart" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card stat-card-warning">
            <div class="flex items-center justify-between relative z-10">
              <div>
                <p class="text-yellow-100 text-sm font-medium">Caixa Extra</p>
                <p class="text-3xl font-bold">R$ <span id="totalCaixa">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="gift" class="w-6 h-6"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="card-elegant p-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
            <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-2">
              <i data-lucide="list" class="w-5 h-5 text-blue-600"></i>
              Contribuições
            </h2>
            
            <div class="flex gap-3">
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Mês</label>
                <input id="memberMonth" type="number" min="1" max="12" class="input-small w-20 text-center" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Ano</label>
                <input id="memberYear" type="number" min="2023" max="2030" class="input-small w-24 text-center" />
              </div>
            </div>
          </div>
          
          <div class="table-elegant">
            <table>
              <thead>
                <tr>
                  <th>Membro</th>
                  <th style="text-align: center;">
                    <div class="flex items-center justify-center gap-1">
                      <i data-lucide="heart" class="w-4 h-4 text-red-500"></i>
                      RCC (R$)
                    </div>
                  </th>
                  <th style="text-align: center;">
                    <div class="flex items-center justify-center gap-1">
                      <i data-lucide="gift" class="w-4 h-4 text-yellow-500"></i>
                      Caixa Extra (R$)
                    </div>
                  </th>
                  <th style="text-align: center;">Ação</th>
                </tr>
              </thead>
              <tbody id="membersTableBody">
                <tr>
                  <td colspan="4" style="padding: 32px; text-align: center; color: var(--neutral-500);">
                    <div class="flex flex-col items-center gap-2">
                      <div class="loading-spinner"></div>
                      <div>Carregando membros...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CONTABILIDADE -->
      <section id="contabilidade" class="hidden space-y-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl flex items-center justify-center">
            <i data-lucide="bar-chart-3" class="w-6 h-6 text-white"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Contabilidade</h1>
            <p class="text-gray-600">Relatório anual consolidado</p>
          </div>
        </div>

        <div class="card-elegant p-6">
          <div class="flex flex-col md:flex-row md:items-center gap-4">
            <label class="text-sm font-medium text-gray-700">Ano do relatório:</label>
            <input id="reportYearInput" type="number" min="2023" max="2030" class="input-small w-24 text-center" />
            <span class="text-lg font-semibold text-gray-900">Relatório de <span id="reportYear">2025</span></span>
            <div class="md:ml-auto">
              <button id="btnGeneratePDF" class="btn-success">
                <i data-lucide="download" class="w-4 h-4"></i>
                Gerar PDF
              </button>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
          <div class="card-elegant p-4 text-center">
            <div class="text-green-600 text-2xl font-bold">R$ <span id="annualEntradas">0.00</span></div>
            <div class="text-sm text-gray-600">Entradas</div>
          </div>
          <div class="card-elegant p-4 text-center">
            <div class="text-blue-600 text-2xl font-bold">R$ <span id="annualRcc">0.00</span></div>
            <div class="text-sm text-gray-600">RCC</div>
          </div>
          <div class="card-elegant p-4 text-center">
            <div class="text-red-600 text-2xl font-bold">R$ <span id="annualSaidas">0.00</span></div>
            <div class="text-sm text-gray-600">Saídas</div>
          </div>
          <div class="card-elegant p-4 text-center">
            <div class="text-yellow-600 text-2xl font-bold">R$ <span id="annualCaixa">0.00</span></div>
            <div class="text-sm text-gray-600">Caixa Extra</div>
          </div>
          <div class="card-elegant p-4 text-center">
            <div class="text-2xl font-bold" id="annualSaldo">R$ 0.00</div>
            <div class="text-sm text-gray-600">Resultado</div>
          </div>
        </div>

        <div class="card-elegant p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="calendar" class="w-5 h-5 text-blue-600"></i>
            Detalhamento Mensal
          </h2>
          
          <div class="table-elegant">
            <table>
              <thead>
                <tr>
                  <th>Mês</th>
                  <th style="text-align: right;">Entradas</th>
                  <th style="text-align: right;">RCC</th>
                  <th style="text-align: right;">Saídas</th>
                  <th style="text-align: right;">Caixa Extra</th>
                  <th style="text-align: right;">Resultado</th>
                  <th style="text-align: center;">Ação</th>
                </tr>
              </thead>
              <tbody id="reportTableBody">
                <tr>
                  <td colspan="7" style="padding: 32px; text-align: center; color: var(--neutral-500);">
                    <div class="flex flex-col items-center gap-2">
                      <div class="loading-spinner"></div>
                      <div>Carregando relatório...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

    </div>
  </main>
</div>

<script>
  // ====== PRESET MEMBERS (Corrigido - sem repetições) ======
  const PRESET_MEMBERS = [
    'LUCAS NICOLAS', 'MILENA', 'TELMIRA', 'HENRIQUE', 'ROBERTA', 'NOEMI',
    'VERA', 'MARLY', 'FLAVIO', 'ENIO', 'JESSICA', 'MARIA LIMA',
    'MARIA DE JESUS', 'ELISANGELA', 'GERALDA', 'LUCAS OLIVEIRA'
  ];

  // ====== STORAGE HELPERS ======
  const STORAGE_KEYS = {
    MEMBERS: 'tesouraria_members',
    TRANSACTIONS: 'tesouraria_transactions',  
    CONTRIBUTIONS: 'tesouraria_contributions'
  };

  const getStorageData = (key) => {
    try {
      const data = localStorage.getItem(key);
      return data ? JSON.parse(data) : [];
    } catch (error) {
      console.error(`Error reading ${key}:`, error);
      return [];
    }
  };

  const setStorageData = (key, data) => {
    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (error) {
      console.error(`Error saving ${key}:`, error);
    }
  };

  // ====== DATE HELPERS (Corrigido - sem problemas de fuso horário) ======
  const formatDateForInput = (date) => {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  };

  const parseInputDate = (dateString) => {
    const [year, month, day] = dateString.split('-').map(Number);
    return new Date(year, month - 1, day);
  };

  const formatDateDisplay = (dateString) => {
    try {
      const date = parseInputDate(dateString);
      return date.toLocaleDateString('pt-BR');
    } catch {
      return 'Data inválida';
    }
  };

  const getMonthShortName = (month) => {
    const months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
    return months[month - 1] || 'Mês inválido';
  };

  // ====== UI HELPERS ======
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  function setActiveView(viewId) {
    // Update navigation
    $$('.nav-item').forEach(n => n.classList.remove('active'));
    $$('.mobile-nav').forEach(n => n.classList.remove('active'));
    
    const nav = $(`.nav-item[data-view="${viewId}"]`);
    const mobileNav = $(`.mobile-nav[data-view="${viewId}"]`);
    if (nav) nav.classList.add('active');
    if (mobileNav) mobileNav.classList.add('active');

    // Update sections
    $$('#views > section').forEach(s => s.classList.add('hidden'));
    const section = $(`#${viewId}`);
    if (section) {
      section.classList.remove('hidden');
      section.classList.add('fade-in');
    }

    // Close mobile menu
    $('#mobileMenu').classList.remove('active');
    const toggleIcon = $('#mobileMenuToggle i');
    if (toggleIcon) {
      toggleIcon.setAttribute('data-lucide', 'menu');
      lucide.createIcons();
    }
  }

  function toast(msg) {
    try {
      $$('.toast').forEach(t => t.remove());
      const t = document.createElement('div');
      t.innerText = msg;
      t.className = 'toast';
      document.body.appendChild(t);
      setTimeout(() => {
        if (t.parentNode) {
          t.style.animation = 'slideInRight 0.3s ease-out reverse';
          setTimeout(() => { if (t.parentNode) t.remove(); }, 300);
        }
      }, 3000);
    } catch (error) {
      console.error('Error showing toast:', error);
    }
  }

  // ====== MEMBERS MANAGEMENT ======
  const initializePresetMembers = () => {
    const existingMembers = getStorageData(STORAGE_KEYS.MEMBERS);
    const existingNames = new Set(existingMembers.map(m => m.name.toUpperCase()));
    
    const newMembers = PRESET_MEMBERS
      .filter(name => !existingNames.has(name.toUpperCase()))
      .map(name => ({
        id: `member_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
        name: name.toUpperCase(),
        createdAt: new Date().toISOString()
      }));
    
    if (newMembers.length > 0) {
      setStorageData(STORAGE_KEYS.MEMBERS, [...existingMembers, ...newMembers]);
    }
  };

  const addMember = (name) => {
    const members = getStorageData(STORAGE_KEYS.MEMBERS);
    const upperName = name.trim().toUpperCase();
    
    if (members.some(m => m.name.toUpperCase() === upperName)) {
      throw new Error('Membro já existe');
    }
    
    const newMember = {
      id: `member_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      name: upperName,
      createdAt: new Date().toISOString()
    };
    
    members.push(newMember);
    setStorageData(STORAGE_KEYS.MEMBERS, members);
  };

  const deleteMember = (memberId) => {
    const members = getStorageData(STORAGE_KEYS.MEMBERS).filter(m => m.id !== memberId);
    setStorageData(STORAGE_KEYS.MEMBERS, members);
    
    const contributions = getStorageData(STORAGE_KEYS.CONTRIBUTIONS).filter(c => c.memberId !== memberId);
    setStorageData(STORAGE_KEYS.CONTRIBUTIONS, contributions);
  };

  // ====== TRANSACTIONS MANAGEMENT ======
  const addTransaction = (transaction) => {
    const transactions = getStorageData(STORAGE_KEYS.TRANSACTIONS);
    const newTransaction = {
      ...transaction,
      id: `tx_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      createdAt: new Date().toISOString()
    };
    
    transactions.push(newTransaction);
    setStorageData(STORAGE_KEYS.TRANSACTIONS, transactions);
  };

  const deleteTransaction = (transactionId) => {
    const transactions = getStorageData(STORAGE_KEYS.TRANSACTIONS).filter(t => t.id !== transactionId);
    setStorageData(STORAGE_KEYS.TRANSACTIONS, transactions);
  };

  // ====== CONTRIBUTIONS MANAGEMENT ======
  const initializeContributions = (month, year) => {
    const members = getStorageData(STORAGE_KEYS.MEMBERS);
    const contributions = getStorageData(STORAGE_KEYS.CONTRIBUTIONS);
    
    const newContributions = members
      .filter(member => !contributions.some(c => 
        c.memberId === member.id && c.month === month && c.year === year
      ))
      .map(member => ({
        id: `contrib_${Date.now()}_${member.id}_${month}_${year}`,
        memberId: member.id,
        memberName: member.name,
        month,
        year,
        rcc: 0,
        caixaExtra: 0
      }));
    
    if (newContributions.length > 0) {
      setStorageData(STORAGE_KEYS.CONTRIBUTIONS, [...contributions, ...newContributions]);
    }
  };

  const updateContribution = (contributionId, field, value) => {
    const contributions = getStorageData(STORAGE_KEYS.CONTRIBUTIONS);
    const index = contributions.findIndex(c => c.id === contributionId);
    
    if (index !== -1) {
      contributions[index][field] = value;
      setStorageData(STORAGE_KEYS.CONTRIBUTIONS, contributions);
    }
  };

  // ====== CURRENT STATE ======
  let currentMonth = new Date().getMonth() + 1;
  let currentYear = new Date().getFullYear();

  // ====== LOAD TRANSACTIONS ======
  const loadTransactions = (month = currentMonth, year = currentYear) => {
    try {
      currentMonth = Number(month); 
      currentYear = Number(year);
      
      if ($('#selectedMonth')) $('#selectedMonth').value = currentMonth;
      if ($('#selectedYear')) $('#selectedYear').value = currentYear;

      const allTransactions = getStorageData(STORAGE_KEYS.TRANSACTIONS);
      const filtered = allTransactions
        .filter(t => t.month === currentMonth && t.year === currentYear)
        .sort((a, b) => {
          const dateComparison = b.date.localeCompare(a.date);
          if (dateComparison !== 0) return dateComparison;
          return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
        });

      const tbody = $('#transactionsList');
      if (!tbody) return;

      if (filtered.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" style="padding: 32px; text-align: center; color: var(--neutral-500);">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="inbox" class="w-8 h-8 text-gray-300"></i>
            <div>Nenhuma transação registrada para ${month}/${year}</div>
          </div>
        </td></tr>`;
      } else {
        tbody.innerHTML = filtered.map(r => `
          <tr class="hover:bg-gray-50 transition-colors">
            <td style="padding: 16px;">
              <div class="font-medium">${formatDateDisplay(r.date)}</div>
            </td>
            <td style="padding: 16px;">
              <span class="${r.type === 'entrada' ? 'badge-success' : 'badge-danger'}">
                <i data-lucide="${r.type === 'entrada' ? 'trending-up' : 'trending-down'}" class="w-3 h-3"></i>
                ${r.type === 'entrada' ? 'Entrada' : 'Saída'}
              </span>
            </td>
            <td style="padding: 16px;">
              <div class="font-medium text-gray-900">${r.description || 'Sem descrição'}</div>
            </td>
            <td style="padding: 16px; text-align: right;">
              <div class="font-semibold ${r.type === 'entrada' ? 'text-green-600' : 'text-red-600'}">
                R$ ${Number(r.value || 0).toFixed(2)}
              </div>
            </td>
            <td style="padding: 16px; text-align: center;">
              <button data-id="${r.id}" class="deleteTx btn-danger">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }

      lucide.createIcons();

      $$('.deleteTx').forEach(btn => btn.addEventListener('click', async e => {
        const id = e.target.closest('button')?.dataset.id;
        if(!id) return;
        if(!confirm('🗑️ Tem certeza que deseja excluir esta transação?')) return;
        try {
          deleteTransaction(id);
          toast('🗑️ Transação excluída!');
          loadTransactions(currentMonth, currentYear);
        } catch (error) {
          console.error('Error deleting transaction:', error);
          toast('❌ Erro ao excluir transação');
        }
      }));

      const entradas = filtered.filter(r=> r.type === 'entrada').reduce((s,r)=> s + Number(r.value||0), 0);
      const saidas = filtered.filter(r=> r.type === 'saida').reduce((s,r)=> s + Number(r.value||0), 0);
      const saldo = entradas - saidas;
      
      if ($('#totalEntradas')) $('#totalEntradas').innerText = entradas.toFixed(2);
      if ($('#totalSaidas')) $('#totalSaidas').innerText = saidas.toFixed(2);
      if ($('#saldoAtual')) {
        $('#saldoAtual').innerText = saldo.toFixed(2);
        const saldoCard = $('#saldoCard');
        if (saldoCard) {
          saldoCard.className = saldo >= 0 ? 'stat-card' : 'stat-card stat-card-danger';
        }
      }
    } catch (error) {
      console.error('Error loading transactions:', error);
      const tbody = $('#transactionsList');
      if (tbody) {
        tbody.innerHTML = `<tr><td colspan="5" style="padding: 32px; text-align: center; color: var(--danger-500);">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="alert-circle" class="w-8 h-8"></i>
            <div>Erro ao carregar transações</div>
          </div>
        </td></tr>`;
      }
    }
  };

  // ====== LOAD MEMBERS AND CONTRIBUTIONS ======
  const loadMembersAndContributions = (month = currentMonth, year = currentYear) => {
    try {
      currentMonth = Number(month); 
      currentYear = Number(year);
      
      if ($('#memberMonth')) $('#memberMonth').value = currentMonth;
      if ($('#memberYear')) $('#memberYear').value = currentYear;

      // Initialize contributions for the selected month/year
      initializeContributions(currentMonth, currentYear);
      
      const allContributions = getStorageData(STORAGE_KEYS.CONTRIBUTIONS);
      const filtered = allContributions
        .filter(c => c.month === currentMonth && c.year === currentYear)
        .sort((a, b) => a.memberName.localeCompare(b.memberName));
      
      if ($('#membersCount')) $('#membersCount').innerText = filtered.length;

      const table = $('#membersTableBody');
      if (!table) return;

      if (filtered.length === 0) {
        table.innerHTML = `<tr><td colspan="4" style="padding: 32px; text-align: center; color: var(--neutral-500);">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="users-x" class="w-8 h-8 text-gray-300"></i>
            <div>Nenhum membro encontrado para ${month}/${year}</div>
          </div>
        </td></tr>`;
      } else {
        table.innerHTML = filtered.map(c => `
          <tr class="hover:bg-gray-50 transition-colors">
            <td style="padding: 16px;">
              <div class="flex items-center gap-3">
                <div class="avatar">
                  ${(c.memberName || 'N').charAt(0)}
                </div>
                <div class="font-medium text-gray-900">${c.memberName || 'Nome não informado'}</div>
              </div>
            </td>
            <td style="padding: 16px; text-align: center;">
              <input data-id="${c.id}" data-field="rcc" type="number" min="0" step="0.01" value="${Number(c.rcc||0)}" 
                     class="input-small w-28 text-center contribution-input" />
            </td>
            <td style="padding: 16px; text-align: center;">
              <input data-id="${c.id}" data-field="caixaExtra" type="number" min="0" step="0.01" value="${Number(c.caixaExtra||0)}" 
                     class="input-small w-28 text-center contribution-input" />
            </td>
            <td style="padding: 16px; text-align: center;">
              <button data-memberid="${c.memberId}" class="delMember btn-danger">
                <i data-lucide="user-minus" class="w-4 h-4"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }

      lucide.createIcons();

      $$('.contribution-input').forEach(inp => {
        inp.addEventListener('change', async e => {
          const id = e.target.dataset.id;
          const field = e.target.dataset.field;
          const value = Math.max(0, Number(e.target.value || 0));
          try {
            updateContribution(id, field, value);
            toast('💝 Contribuição atualizada!');
            calculateContributionTotals();
          } catch (error) {
            console.error('Error updating contribution:', error);
            toast('❌ Erro ao atualizar contribuição');
          }
        });
      });

      $$('.delMember').forEach(btn => btn.addEventListener('click', async e => {
        const memberId = e.target.closest('button')?.dataset.memberid;
        if(!memberId) return;
        if(!confirm('👥 Tem certeza que deseja excluir este membro e todas as contribuições dele?')) return;
        try {
          deleteMember(memberId);
          toast('👥 Membro excluído!');
          loadMembersAndContributions(currentMonth, currentYear);
        } catch (error) {
          console.error('Error deleting member:', error);
          toast('❌ Erro ao excluir membro');
        }
      }));

      calculateContributionTotals();

    } catch (error) {
      console.error('Error loading members and contributions:', error);
      const table = $('#membersTableBody');
      if (table) {
        table.innerHTML = `<tr><td colspan="4" style="padding: 32px; text-align: center; color: var(--danger-500);">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="alert-circle" class="w-8 h-8"></i>
            <div>Erro ao carregar membros</div>
          </div>
        </td></tr>`;
      }
    }
  };

  const calculateContributionTotals = () => {
    try {
      const rccInputs = $$('.contribution-input[data-field="rcc"]');
      const caixaInputs = $$('.contribution-input[data-field="caixaExtra"]');
      const totalRcc = rccInputs.reduce((sum, input) => sum + Number(input.value || 0), 0);
      const totalCaixa = caixaInputs.reduce((sum, input) => sum + Number(input.value || 0), 0);
      if ($('#totalRcc')) $('#totalRcc').innerText = totalRcc.toFixed(2);
      if ($('#totalCaixa')) $('#totalCaixa').innerText = totalCaixa.toFixed(2);
    } catch (error) {
      console.error('Error calculating totals:', error);
    }
  };

  // ====== ANNUAL REPORT ======
  const buildAnnualReport = (year) => {
    try {
      year = Number(year);
      const transactions = getStorageData(STORAGE_KEYS.TRANSACTIONS).filter(t => t.year === year);
      const contributions = getStorageData(STORAGE_KEYS.CONTRIBUTIONS).filter(c => c.year === year);

      const monthly = Array.from({length:12}, (_,i) => ({ month: i+1, entradas:0, saidas:0, rcc:0, caixaExtra:0 }));
      
      for(const t of transactions){
        const mIndex = Number(t.month) - 1;
        if(mIndex >= 0 && mIndex < 12) {
          if(t.type === 'entrada') monthly[mIndex].entradas += Number(t.value||0);
          else monthly[mIndex].saidas += Number(t.value||0);
        }
      }

      for(const c of contributions){
        const idx = Number(c.month) - 1;
        if(idx >= 0 && idx < 12) {
          monthly[idx].rcc += Number(c.rcc||0);
          monthly[idx].caixaExtra += Number(c.caixaExtra||0);
        }
      }

      const report = monthly.map((m, i) => ({
        month: m.month,
        entradas: m.entradas,
        rcc: m.rcc,
        saidas: m.saidas,
        caixaExtra: m.caixaExtra,
        resultado: (m.entradas + m.rcc) - m.saidas
      }));

      const totals = {
        totalEntradas: report.reduce((s,r)=> s + r.entradas, 0),
        totalRcc: report.reduce((s,r)=> s + r.rcc, 0),
        totalSaidas: report.reduce((s,r)=> s + r.saidas, 0),
        totalCaixaExtra: report.reduce((s,r)=> s + r.caixaExtra, 0),
        lucroLiquido: report.reduce((s,r)=> s + r.resultado, 0)
      };

      if ($('#reportYear')) $('#reportYear').innerText = year;
      
      const tbody = $('#reportTableBody');
      if (!tbody) return;
      
      tbody.innerHTML = report.map(r => `
        <tr class="hover:bg-gray-50 transition-colors">
          <td style="padding: 16px;">
            <div class="font-medium">${getMonthShortName(r.month)}</div>
          </td>
          <td style="padding: 16px; text-align: right;">
            <div class="font-medium text-green-600">R$ ${r.entradas.toFixed(2)}</div>
          </td>
          <td style="padding: 16px; text-align: right;">
            <div class="font-medium text-blue-600">R$ ${r.rcc.toFixed(2)}</div>
          </td>
          <td style="padding: 16px; text-align: right;">
            <div class="font-medium text-red-600">R$ ${r.saidas.toFixed(2)}</div>
          </td>
          <td style="padding: 16px; text-align: right;">
            <div class="font-medium text-yellow-600">R$ ${r.caixaExtra.toFixed(2)}</div>
          </td>
          <td style="padding: 16px; text-align: right;">
            <div class="font-bold ${r.resultado >= 0 ? 'text-green-600' : 'text-red-600'}">
              R$ ${r.resultado.toFixed(2)}
            </div>
          </td>
          <td style="padding: 16px; text-align: center;">
            <button class="btn-secondary btnViewMonth" data-month="${r.month}" data-year="${year}">
              <i data-lucide="eye" class="w-4 h-4"></i>
              Ver
            </button>
          </td>
        </tr>
      `).join('');

      lucide.createIcons();

      $$('.btnViewMonth').forEach(btn => btn.addEventListener('click', () => {
        const m = Number(btn.dataset.month);
        const y = Number(btn.dataset.year);
        if ($('#selectedMonth')) $('#selectedMonth').value = m;
        if ($('#selectedYear')) $('#selectedYear').value = y;
        setActiveView('tesouraria');
        loadTransactions(m, y);
      }));

      if ($('#annualEntradas')) $('#annualEntradas').innerText = totals.totalEntradas.toFixed(2);
      if ($('#annualRcc')) $('#annualRcc').innerText = totals.totalRcc.toFixed(2);
      if ($('#annualSaidas')) $('#annualSaidas').innerText = totals.totalSaidas.toFixed(2);
      if ($('#annualCaixa')) $('#annualCaixa').innerText = totals.totalCaixaExtra.toFixed(2);
      if ($('#annualSaldo')) {
        const saldoElement = $('#annualSaldo');
        saldoElement.innerText = totals.lucroLiquido.toFixed(2);
        saldoElement.className = totals.lucroLiquido >= 0 ? 'text-2xl font-bold text-green-600' : 'text-2xl font-bold text-red-600';
      }

      // Store report data for PDF generation
      window.currentReportData = { report, totals, year };
    } catch (error) {
      console.error('Error generating annual report:', error);
    }
  };

  // ====== PDF GENERATION ======
  const generatePDF = () => {
    try {
      if (!window.jsPDF || !window.currentReportData) {
        toast('❌ Erro ao gerar PDF - dados não disponíveis');
        return;
      }

      const { jsPDF } = window.jsPDF;
      const doc = new jsPDF();
      const { report, totals, year } = window.currentReportData;
      
      // Header
      doc.setFontSize(20);
      doc.setTextColor(40, 40, 40);
      doc.text('Relatório Anual - Tesouraria', 20, 30);
      doc.text(`Grupo de Oração - ${year}`, 20, 45);
      
      // Summary boxes
      doc.setFontSize(12);
      doc.setFillColor(240, 240, 240);
      
      const summaryY = 65;
      const boxWidth = 35;
      const boxHeight = 25;
      
      // Entradas
      doc.rect(20, summaryY, boxWidth, boxHeight, 'F');
      doc.setTextColor(34, 197, 94);
      doc.text('Entradas', 22, summaryY + 8);
      doc.text(`R$ ${totals.totalEntradas.toFixed(2)}`, 22, summaryY + 16);
      
      // RCC
      doc.setFillColor(240, 240, 240);
      doc.rect(60, summaryY, boxWidth, boxHeight, 'F');
      doc.setTextColor(59, 130, 246);
      doc.text('RCC', 62, summaryY + 8);
      doc.text(`R$ ${totals.totalRcc.toFixed(2)}`, 62, summaryY + 16);
      
      // Saídas
      doc.rect(100, summaryY, boxWidth, boxHeight, 'F');
      doc.setTextColor(239, 68, 68);
      doc.text('Saídas', 102, summaryY + 8);
      doc.text(`R$ ${totals.totalSaidas.toFixed(2)}`, 102, summaryY + 16);
      
      // Caixa Extra
      doc.rect(140, summaryY, boxWidth, boxHeight, 'F');
      doc.setTextColor(245, 158, 11);
      doc.text('Caixa Extra', 142, summaryY + 8);  
      doc.text(`R$ ${totals.totalCaixaExtra.toFixed(2)}`, 142, summaryY + 16);

      // Monthly detail table
      const tableData = report.map(r => [
        getMonthShortName(r.month),
        `R$ ${r.entradas.toFixed(2)}`,
        `R$ ${r.rcc.toFixed(2)}`,
        `R$ ${r.saidas.toFixed(2)}`,
        `R$ ${r.caixaExtra.toFixed(2)}`,
        `R$ ${r.resultado.toFixed(2)}`
      ]);

      doc.autoTable({
        startY: summaryY + 40,
        head: [['Mês', 'Entradas', 'RCC', 'Saídas', 'Caixa Extra', 'Resultado']],
        body: tableData,
        styles: { fontSize: 10 },
        headStyles: { fillColor: [59, 130, 246] },
        alternateRowStyles: { fillColor: [248, 250, 252] },
        margin: { left: 20, right: 20 }
      });
      
      // Footer
      const pageCount = doc.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(10);
        doc.setTextColor(128, 128, 128);
        doc.text(
          `Gerado em ${new Date().toLocaleDateString('pt-BR')} - Página ${i} de ${pageCount}`,
          20,
          doc.internal.pageSize.height - 20
        );
      }
      
      doc.save(`relatorio-tesouraria-${year}.pdf`);
      toast('📄 Relatório PDF gerado com sucesso!');
    } catch (error) {
      console.error('Error generating PDF:', error);
      toast('❌ Erro ao gerar PDF');
    }
  };

  // ====== EVENT BINDINGS ======
  window.addEventListener('DOMContentLoaded', async () => {
    try {
      // Initialize preset members
      initializePresetMembers();

      // Navigation
      $$('.nav-item, .mobile-nav').forEach(btn => btn.addEventListener('click', e => {
        const target = e.currentTarget.dataset.view;
        setActiveView(target);
      }));

      // Mobile menu toggle
      $('#mobileMenuToggle')?.addEventListener('click', () => {
        const menu = $('#mobileMenu');
        const toggleIcon = $('#mobileMenuToggle i');
        if (menu.classList.contains('active')) {
          menu.classList.remove('active');
          toggleIcon.setAttribute('data-lucide', 'menu');
        } else {
          menu.classList.add('active');
          toggleIcon.setAttribute('data-lucide', 'x');
        }
        lucide.createIcons();
      });

      // Set initial view
      setActiveView('tesouraria');

      // Load initial data
      await loadTransactions(currentMonth, currentYear);
      await loadMembersAndContributions(currentMonth, currentYear);  
      await buildAnnualReport(currentYear);

      // Transaction form
      const txForm = $('#txForm');
      if (txForm) {
        txForm.addEventListener('submit', async e => {
          e.preventDefault();
          const type = $('#txType')?.value || 'entrada';
          const desc = $('#txDesc')?.value?.trim() || '';
          const val = $('#txValue')?.value || '0';
          const data = $('#txDate')?.value || formatDateForInput(new Date());
          
          if(!desc || !val || val === '0') {
            toast('❌ Preencha descrição e valor');
            return;
          }
          if(!data) {
            toast('❌ Selecione uma data');
            return;
          }

          try {
            const parsedDate = parseInputDate(data);
            const month = parsedDate.getMonth() + 1;
            const year = parsedDate.getFullYear();

            addTransaction({ 
              type, 
              description: desc, 
              value: parseFloat(val), 
              date: data,
              month,
              year
            });
            
            toast('💰 Transação registrada com sucesso!');
            txForm.reset();
            const today = new Date();
            if ($('#txDate')) $('#txDate').value = formatDateForInput(today);
            
            loadTransactions(currentMonth, currentYear);
          } catch (error) {
            console.error('Error adding transaction:', error);
            toast('❌ Erro ao salvar transação');
          }
        });
      }

      // Date filters - Tesouraria
      $('#selectedMonth')?.addEventListener('change', () => {
        const month = Number($('#selectedMonth')?.value || currentMonth);
        const year = Number($('#selectedYear')?.value || currentYear);
        loadTransactions(month, year);
      });

      $('#selectedYear')?.addEventListener('change', () => {
        const month = Number($('#selectedMonth')?.value || currentMonth);
        const year = Number($('#selectedYear')?.value || currentYear);
        loadTransactions(month, year);
      });

      // Date filters - Membros
      $('#memberMonth')?.addEventListener('change', () => {
        const month = Number($('#memberMonth')?.value || currentMonth);
        const year = Number($('#memberYear')?.value || currentYear);
        loadMembersAndContributions(month, year);
      });

      $('#memberYear')?.addEventListener('change', () => {
        const month = Number($('#memberMonth')?.value || currentMonth);
        const year = Number($('#memberYear')?.value || currentYear);
        loadMembersAndContributions(month, year);
      });

      // Annual report year filter
      $('#reportYearInput')?.addEventListener('change', () => {
        const year = Number($('#reportYearInput')?.value || currentYear);
        buildAnnualReport(year);
      });

      // Add member
      const addMemberHandler = () => {
        const name = $('#newMemberName')?.value || '';
        if (!name.trim()) {
          toast('❌ Digite o nome do membro');
          return;
        }
        try {
          addMember(name);
          toast('👥 Membro adicionado com sucesso!');
          $('#newMemberName').value = '';
          loadMembersAndContributions(currentMonth, currentYear);
        } catch (error) {
          toast(error.message || '❌ Erro ao adicionar membro');
        }
      };

      $('#btnAddMember')?.addEventListener('click', addMemberHandler);
      $('#newMemberName')?.addEventListener('keypress', e => {
        if(e.key === 'Enter') addMemberHandler();
      });

      // Generate PDF
      $('#btnGeneratePDF')?.addEventListener('click', generatePDF);

      // Initialize form values
      const today = new Date();
      const todayStr = formatDateForInput(today);
      
      const elements = [
        { id: 'txDate', value: todayStr },
        { id: 'selectedMonth', value: currentMonth },
        { id: 'selectedYear', value: currentYear },
        { id: 'memberMonth', value: currentMonth },
        { id: 'memberYear', value: currentYear },
        { id: 'reportYearInput', value: currentYear }
      ];
      
      elements.forEach(({ id, value }) => {
        const element = document.getElementById(id);
        if (element) element.value = value;
      });

      // Initialize icons
      lucide.createIcons();
      
    } catch (error) {
      console.error('Error initializing application:', error);
      toast('❌ Erro ao inicializar aplicação');
    }
  });
</script>

</body>
</html>
