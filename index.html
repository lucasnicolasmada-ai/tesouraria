<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tesouraria - Grupo de Oração</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <style>
    :root {
      --primary-50: #f0f9ff;
      --primary-100: #e0f2fe;
      --primary-200: #bae6fd;
      --primary-500: #0ea5e9;
      --primary-600: #0284c7;
      --primary-700: #0369a1;
      --primary-900: #0c4a6e;
      
      --secondary-50: #fefce8;
      --secondary-100: #fef3c7;
      --secondary-500: #eab308;
      --secondary-600: #ca8a04;
      
      --success-50: #f0fdf4;
      --success-500: #22c55e;
      --success-600: #16a34a;
      
      --danger-50: #fef2f2;
      --danger-500: #ef4444;
      --danger-600: #dc2626;
      
      --neutral-50: #f8fafc;
      --neutral-100: #f1f5f9;
      --neutral-200: #e2e8f0;
      --neutral-300: #cbd5e1;
      --neutral-400: #94a3b8;
      --neutral-500: #64748b;
      --neutral-600: #475569;
      --neutral-700: #334155;
      --neutral-800: #1e293b;
      --neutral-900: #0f172a;
    }

    * {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--primary-50) 0%, var(--neutral-100) 100%);
      min-height: 100vh;
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .card-elegant {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border: 1px solid var(--neutral-200);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-elegant:hover {
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      transform: translateY(-2px);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px 0 rgba(2, 132, 199, 0.3);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--primary-700), var(--primary-600));
      transform: translateY(-2px);
      box-shadow: 0 8px 25px 0 rgba(2, 132, 199, 0.4);
    }

    .btn-secondary {
      background: white;
      color: var(--primary-600);
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 600;
      border: 2px solid var(--primary-200);
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-secondary:hover {
      background: var(--primary-50);
      border-color: var(--primary-300);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success-500), var(--success-600));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px 0 rgba(34, 197, 94, 0.3);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px 0 rgba(34, 197, 94, 0.4);
    }

    .btn-danger {
      color: var(--danger-500);
      background: var(--danger-50);
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 500;
      border: 1px solid var(--danger-200);
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn-danger:hover {
      background: var(--danger-500);
      color: white;
    }

    .input-elegant {
      padding: 12px 16px;
      border: 2px solid var(--neutral-200);
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
      width: 100%;
    }

    .input-elegant:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
    }

    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.1);
      border-right: 1px solid var(--neutral-200);
    }

    .nav-item {
      color: var(--neutral-700);
      padding: 12px 20px;
      border-radius: 12px;
      margin: 4px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: var(--primary-50);
      color: var(--primary-700);
      transform: translateX(4px);
    }

    .nav-item.active {
      background: var(--primary-600);
      color: white;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
      color: white;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(2, 132, 199, 0.3);
    }

    .stat-card-success {
      background: linear-gradient(135deg, var(--success-500), var(--success-600));
      box-shadow: 0 8px 32px rgba(34, 197, 94, 0.3);
    }

    .stat-card-warning {
      background: linear-gradient(135deg, var(--secondary-500), var(--secondary-600));
      box-shadow: 0 8px 32px rgba(234, 179, 8, 0.3);
    }

    .table-elegant {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    .table-elegant thead {
      background: var(--neutral-50);
    }

    .table-elegant th {
      padding: 16px;
      font-weight: 600;
      color: var(--neutral-700);
      border-bottom: 1px solid var(--neutral-200);
      white-space: nowrap;
    }

    .table-elegant td {
      padding: 16px;
      border-bottom: 1px solid var(--neutral-100);
      white-space: nowrap;
    }

    .table-elegant tbody tr:hover {
      background: var(--neutral-50);
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--neutral-900);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: slideInRight 0.3s ease-out;
      max-width: 320px;
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .mobile-header {
      display: none;
      background: var(--primary-600);
      color: white;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .mobile-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--neutral-200);
      padding: 12px;
      box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.1);
      z-index: 50;
    }

    .mobile-nav-item {
      flex: 1;
      padding: 12px 8px;
      text-align: center;
      cursor: pointer;
      border-radius: 12px;
      transition: all 0.3s ease;
      color: var(--neutral-600);
      font-size: 12px;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .mobile-nav-item:hover, .mobile-nav-item.active {
      background: var(--primary-50);
      color: var(--primary-600);
    }

    @media (max-width: 1024px) {
      .sidebar { display: none; }
      .mobile-header { display: block; }
      .mobile-nav { display: flex; }
      .main-content { 
        padding: 16px; 
        padding-bottom: 80px;
      }
      
      .grid {
        grid-template-columns: 1fr !important;
      }
      
      .md\\:grid-cols-3 {
        grid-template-columns: 1fr !important;
      }
      
      .md\\:grid-cols-4 {
        grid-template-columns: 1fr 1fr !important;
      }
      
      .stat-card {
        padding: 16px;
      }
      
      .card-elegant {
        padding: 16px !important;
      }
    }

    @media (max-width: 640px) {
      .md\\:grid-cols-4 {
        grid-template-columns: 1fr !important;
      }
      
      .table-elegant {
        font-size: 14px;
      }
      
      .table-elegant th,
      .table-elegant td {
        padding: 8px;
      }
    }

    .logo-area {
      padding: 24px 20px;
      border-bottom: 1px solid var(--neutral-200);
      margin-bottom: 20px;
      text-align: center;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      align-items: end;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Melhorias de acessibilidade e usabilidade */
    .btn-primary:disabled,
    .btn-success:disabled,
    .btn-secondary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    /* Estilos para campos obrigatórios */
    .input-elegant:required:invalid {
      border-color: var(--danger-300);
    }

    .input-elegant:required:valid {
      border-color: var(--success-300);
    }
  </style>
</head>
<body>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, query, where, deleteDoc, doc,
    updateDoc, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // ====== Firebase Config ======
  const firebaseConfig = {
    apiKey: "AIzaSyAgVA62x3kIlkefPfrb6ccA7yLln1ZyM8E",
    authDomain: "tesouraria-bcded.firebaseapp.com",
    projectId: "tesouraria-bcded",
    storageBucket: "tesouraria-bcded.firebasestorage.app",
    messagingSenderId: "373337720444",
    appId: "1:373337720444:web:ccca6b0917e5e2054f6bf9",
    measurementId: "G-52WF5DX59X"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // PRESET MEMBERS
  const PRESET_MEMBERS = [
    'LUCAS NICOLAS','MILENA','TELMIRA','HENRIQUE','ROBERTA','NOEMI','VERA','MARLY','FLAVIO','ENIO','JESSICA','MARIA LIMA','MARIA DE JESUS','ELISANGELA','GERALDA','LUCAS OLIVEIRA'
  ];

  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));

  // ======= Helpers de UI =======
  function setActiveView(viewId){
    $$('.nav-item').forEach(n => n.classList.remove('active'));
    $$('.mobile-nav-item').forEach(n => n.classList.remove('active'));
    
    const nav = $(`.nav-item[data-view="${viewId}"]`);
    const mobileNav = $(`.mobile-nav-item[data-view="${viewId}"]`);
    if (nav) nav.classList.add('active');
    if (mobileNav) mobileNav.classList.add('active');

    $$('#views > section').forEach(s => s.classList.add('hidden'));
    const section = $(`#${viewId}`);
    if (section) {
      section.classList.remove('hidden');
      section.classList.add('fade-in');
    }
  }

  // ======= Correção da função de data =======
  function parseLocalDate(dateString) {
    // Força a interpretação da data como local, não UTC
    const parts = dateString.split('-');
    return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
  }

  function formatDateForInput(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  // ======= Firestore helpers =======
  async function ensurePresetMembersExist(){
    try {
      const col = collection(db,'members');
      const snapshot = await getDocs(col);
      const existing = new Set(snapshot.docs.map(d => d.data().name));
      for(const name of PRESET_MEMBERS){
        if(!existing.has(name)){
          await addDoc(col, { name, createdAt: serverTimestamp() });
        }
      }
    } catch (error) {
      console.error('Erro ao verificar membros:', error);
    }
  }

  let currentMonth = new Date().getMonth() + 1;
  let currentYear = new Date().getFullYear();

  // ======= Transactions =======
  async function saveTransaction({ type, description, value, date }){
    try {
      setLoading(true);
      
      // Usa a função corrigida de parseamento de data
      const dateObj = parseLocalDate(date);
      const month = dateObj.getMonth() + 1;
      const year = dateObj.getFullYear();
      
      const col = collection(db,'transactions');
      await addDoc(col, {
        type: type || 'entrada',
        description: description || '',
        value: Number(value) || 0,
        mes: Number(month),
        ano: Number(year),
        data: date, // Mantém a data original como string
        createdAt: serverTimestamp()
      });
      
      await loadTransactions(month, year);
      toast('💰 Transação registrada com sucesso!');
    } catch (error) {
      console.error('Erro ao salvar transação:', error);
      toast('❌ Erro ao salvar transação');
    } finally {
      setLoading(false);
    }
  }

  async function loadTransactions(month = currentMonth, year = currentYear){
    try {
      setLoading(true);
      
      currentMonth = Number(month); 
      currentYear = Number(year);
      if ($('#selectedMonth')) $('#selectedMonth').value = currentMonth;
      if ($('#selectedYear')) $('#selectedYear').value = currentYear;

      const col = collection(db,'transactions');
      const q = query(
        col, 
        where('mes','==', currentMonth), 
        where('ano','==', currentYear)
      );
      
      const snap = await getDocs(q);
      let rows = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      
      // Ordenação no cliente por data (YYYY-MM-DD) desc; fallback por createdAt
      rows.sort((a,b) => {
        const ad = a.data || '';
        const bd = b.data || '';
        if (ad && bd) return bd.localeCompare(ad);
        const at = a.createdAt?.toDate ? a.createdAt.toDate().getTime() : 0;
        const bt = b.createdAt?.toDate ? b.createdAt.toDate().getTime() : 0;
        return bt - at;
      });

      const tbody = $('#transactionsList');
      if (!tbody) return;

      if (rows.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-500">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="inbox" class="w-8 h-8 text-gray-300"></i>
            <div>Nenhuma transação registrada para ${month}/${year}</div>
          </div>
        </td></tr>`;
      } else {
        tbody.innerHTML = rows.map(r => `
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="p-4">
              <div class="font-medium">${formatDate(r.data)}</div>
            </td>
            <td class="p-4">
              <span class="inline-flex px-3 py-1 rounded-full text-xs font-medium ${r.type === 'entrada' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                ${r.type === 'entrada' ? '📈 Entrada' : '📉 Saída'}
              </span>
            </td>
            <td class="p-4">
              <div class="font-medium text-gray-900">${r.description || 'Sem descrição'}</div>
            </td>
            <td class="p-4 text-right">
              <div class="font-semibold ${r.type === 'entrada' ? 'text-green-600' : 'text-red-600'}">
                R$ ${Number(r.value || 0).toFixed(2)}
              </div>
            </td>
            <td class="p-4 text-center">
              <button data-id="${r.id}" class="deleteTx btn-danger">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }

      lucide.createIcons();

      $$('.deleteTx').forEach(btn => btn.addEventListener('click', async e => {
        const id = e.target.closest('button')?.dataset.id;
        if(!id) return;
        if(!confirm('🗑️ Tem certeza que deseja excluir esta transação?')) return;
        try {
          setLoading(true);
          await deleteDoc(doc(db,'transactions', id));
          toast('🗑️ Transação excluída!');
          loadTransactions(currentMonth, currentYear);
        } catch (error) {
          console.error('Erro ao excluir transação:', error);
          toast('❌ Erro ao excluir transação');
        } finally {
          setLoading(false);
        }
      }));

      const entradas = rows.filter(r=> r.type === 'entrada').reduce((s,r)=> s + Number(r.value||0), 0);
      const saidas = rows.filter(r=> r.type === 'saida').reduce((s,r)=> s + Number(r.value||0), 0);
      const saldo = entradas - saidas;
      
      if ($('#totalEntradas')) $('#totalEntradas').innerText = entradas.toFixed(2);
      if ($('#totalSaidas')) $('#totalSaidas').innerText = saidas.toFixed(2);
      if ($('#saldoAtual')) {
        $('#saldoAtual').innerText = saldo.toFixed(2);
        $('#saldoAtual').className = saldo >= 0 ? 'text-green-600 font-bold' : 'text-red-600 font-bold';
      }
    } catch (error) {
      console.error('Erro ao carregar transações:', error);
      const tbody = $('#transactionsList');
      if (tbody) {
        tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-red-500">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="alert-circle" class="w-8 h-8"></i>
            <div>Erro ao carregar transações</div>
          </div>
        </td></tr>`;
      }
    } finally {
      setLoading(false);
    }
  }

  // ======= Members & Contributions =======
  async function loadMembersAndContributions(month = currentMonth, year = currentYear){
    try {
      setLoading(true);
      
      currentMonth = Number(month); 
      currentYear = Number(year);
      
      if ($('#memberMonth')) $('#memberMonth').value = currentMonth;
      if ($('#memberYear')) $('#memberYear').value = currentYear;

      const memSnap = await getDocs(collection(db,'members'));
      const members = memSnap.docs.map(d => ({ id: d.id, ...d.data() })).sort((a,b)=> a.name.localeCompare(b.name));
      
      if ($('#membersCount')) $('#membersCount').innerText = members.length;

      for(const m of members){
        const q = query(
          collection(db,'contributions'), 
          where('memberId','==', m.id), 
          where('month','==', currentMonth), 
          where('year','==', currentYear)
        );
        const snap = await getDocs(q);
        if(snap.empty){
          await addDoc(collection(db,'contributions'), {
            memberId: m.id,
            memberName: m.name,
            month: currentMonth,
            year: currentYear,
            rcc: 0,
            caixaExtra: 0,
            createdAt: serverTimestamp()
          });
        }
      }

      const q2 = query(
        collection(db,'contributions'), 
        where('month','==', currentMonth), 
        where('year','==', currentYear)
      );
      const snap2 = await getDocs(q2);
      const contributions = snap2.docs.map(d => ({ id: d.id, ...d.data() }))
        .sort((a, b) => a.memberName.localeCompare(b.memberName));

      const table = $('#membersTableBody');
      if (!table) return;

      if (contributions.length === 0) {
        table.innerHTML = `<tr><td colspan="4" class="p-8 text-center text-gray-500">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="users-x" class="w-8 h-8 text-gray-300"></i>
            <div>Nenhum membro encontrado para ${month}/${year}</div>
          </div>
        </td></tr>`;
      } else {
        table.innerHTML = contributions.map(c => `
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="p-4">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xs font-bold">
                  ${(c.memberName || 'N').charAt(0)}
                </div>
                <div class="font-medium text-gray-900">${c.memberName || 'Nome não informado'}</div>
              </div>
            </td>
            <td class="p-4 text-center">
              <input data-id="${c.id}" data-field="rcc" type="number" min="0" step="0.01" value="${Number(c.rcc||0)}" 
                     class="input-elegant w-24 text-center contribution-input" />
            </td>
            <td class="p-4 text-center">
              <input data-id="${c.id}" data-field="caixaExtra" type="number" min="0" step="0.01" value="${Number(c.caixaExtra||0)}" 
                     class="input-elegant w-24 text-center contribution-input" />
            </td>
            <td class="p-4 text-center">
              <button data-memberid="${c.memberId}" class="delMember btn-danger">
                <i data-lucide="user-minus" class="w-4 h-4"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }

      lucide.createIcons();

      $$('.contribution-input').forEach(inp => {
        inp.addEventListener('change', async e => {
          const id = e.target.dataset.id;
          const field = e.target.dataset.field;
          const value = Number(e.target.value || 0);
          try {
            await updateDoc(doc(db,'contributions', id), { [field]: value });
            toast('💝 Contribuição atualizada!');
            calculateContributionTotals();
          } catch (error) {
            console.error('Erro ao atualizar contribuição:', error);
            toast('❌ Erro ao atualizar contribuição');
          }
        });
      });

      $$('.delMember').forEach(btn => btn.addEventListener('click', async e => {
        const memberId = e.target.closest('button')?.dataset.memberid;
        if(!memberId) return;
        if(!confirm('👥 Tem certeza que deseja excluir este membro e todas as contribuições dele?')) return;
        try {
          setLoading(true);
          await deleteDoc(doc(db,'members', memberId));
          const q = query(collection(db,'contributions'), where('memberId','==', memberId));
          const qSnap = await getDocs(q);
          for(const d of qSnap.docs) await deleteDoc(doc(db,'contributions', d.id));
          toast('👥 Membro excluído!');
          loadMembersAndContributions(currentMonth, currentYear);
        } catch (error) {
          console.error('Erro ao excluir membro:', error);
          toast('❌ Erro ao excluir membro');
        } finally {
          setLoading(false);
        }
      }));

      calculateContributionTotals();

    } catch (error) {
      console.error('Erro ao carregar membros e contribuições:', error);
      const table = $('#membersTableBody');
      if (table) {
        table.innerHTML = `<tr><td colspan="4" class="p-8 text-center text-red-500">
          <div class="flex flex-col items-center gap-2">
            <i data-lucide="alert-circle" class="w-8 h-8"></i>
            <div>Erro ao carregar membros</div>
          </div>
        </td></tr>`;
      }
    } finally {
      setLoading(false);
    }
  }

  function calculateContributionTotals() {
    try {
      const rccInputs = $$('.contribution-input[data-field="rcc"]');
      const caixaInputs = $$('.contribution-input[data-field="caixaExtra"]');
      const totalRcc = rccInputs.reduce((sum, input) => sum + Number(input.value || 0), 0);
      const totalCaixa = caixaInputs.reduce((sum, input) => sum + Number(input.value || 0), 0);
      if ($('#totalRcc')) $('#totalRcc').innerText = totalRcc.toFixed(2);
      if ($('#totalCaixa')) $('#totalCaixa').innerText = totalCaixa.toFixed(2);
    } catch (error) {
      console.error('Erro ao calcular totais:', error);
    }
  }

  async function addMemberByName(name){
    if(!name || !name.trim()) return toast('❌ Nome inválido');
    try {
      setLoading(true);
      const memberName = name.trim().toUpperCase();
      await addDoc(collection(db,'members'), { name: memberName, createdAt: serverTimestamp() });
      toast('👥 Membro adicionado com sucesso!');
      $('#newMemberName').value = '';
      await loadMembersAndContributions(currentMonth, currentYear);
    } catch (error) {
      console.error('Erro ao adicionar membro:', error);
      toast('❌ Erro ao adicionar membro');
    } finally {
      setLoading(false);
    }
  }

  // ======= Contabilidade anual =======
  async function buildAnnualReport(year){
    try {
      setLoading(true);
      
      year = Number(year);
      const txSnap = await getDocs(collection(db,'transactions'));
      const txs = txSnap.docs.map(d => d.data()).filter(t => {
        const txYear = Number(t.ano) || Number(new Date(t.data).getFullYear());
        return txYear === year;
      });

      const monthly = Array.from({length:12}, (_,i) => ({ month: i+1, entradas:0, saidas:0 }));
      for(const t of txs){
        const mIndex = Number(t.mes) - 1;
        if(mIndex >= 0 && mIndex < 12) {
          if(t.type === 'entrada') monthly[mIndex].entradas += Number(t.value||0);
          else monthly[mIndex].saidas += Number(t.value||0);
        }
      }

      const cSnap = await getDocs(collection(db,'contributions'));
      const contributions = cSnap.docs.map(d => d.data()).filter(c => Number(c.year) === year);

      const rccByMonth = Array(12).fill(0);
      const caixaByMonth = Array(12).fill(0);
      for(const c of contributions){
        const idx = Number(c.month) - 1;
        if(idx >= 0 && idx < 12) {
          rccByMonth[idx] += Number(c.rcc||0);
          caixaByMonth[idx] += Number(c.caixaExtra||0);
        }
      }

      const report = monthly.map((m, i) => ({
        month: m.month,
        entradas: m.entradas,
        rcc: rccByMonth[i],
        saidas: m.saidas,
        caixaExtra: caixaByMonth[i],
        resultado: (m.entradas + rccByMonth[i]) - m.saidas
      }));

      const totals = {
        totalEntradas: report.reduce((s,r)=> s + r.entradas, 0),
        totalRcc: report.reduce((s,r)=> s + r.rcc, 0),
        totalSaidas: report.reduce((s,r)=> s + r.saidas, 0),
        totalCaixaExtra: report.reduce((s,r)=> s + r.caixaExtra, 0),
        lucroLiquido: report.reduce((s,r)=> s + r.resultado, 0)
      };

      if ($('#reportYear')) $('#reportYear').innerText = year;
      
      const tbody = $('#reportTableBody');
      if (!tbody) return;
      
      const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
      
      tbody.innerHTML = report.map(r => `
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="p-4">
            <div class="font-medium">${monthNames[r.month - 1]}</div>
          </td>
          <td class="p-4 text-right">
            <div class="font-medium text-green-600">R$ ${r.entradas.toFixed(2)}</div>
          </td>
          <td class="p-4 text-right">
            <div class="font-medium text-blue-600">R$ ${r.rcc.toFixed(2)}</div>
          </td>
          <td class="p-4 text-right">
            <div class="font-medium text-red-600">R$ ${r.saidas.toFixed(2)}</div>
          </td>
          <td class="p-4 text-right">
            <div class="font-medium text-yellow-600">R$ ${r.caixaExtra.toFixed(2)}</div>
          </td>
          <td class="p-4 text-right">
            <div class="font-bold ${r.resultado >= 0 ? 'text-green-600' : 'text-red-600'}">
              R$ ${r.resultado.toFixed(2)}
            </div>
          </td>
          <td class="p-4 text-right">
            <button class="btn-secondary btnViewMonth" data-month="${r.month}" data-year="${year}">
              <i data-lucide="eye" class="w-4 h-4"></i>
              Ver
            </button>
          </td>
        </tr>
      `).join('');

      lucide.createIcons();

      // Botões "Visualizar" de cada mês -> abre Tesouraria filtrada no mês/ano
      $$('.btnViewMonth').forEach(btn => btn.addEventListener('click', () => {
        const m = Number(btn.dataset.month);
        const y = Number(btn.dataset.year);
        if ($('#selectedMonth')) $('#selectedMonth').value = m;
        if ($('#selectedYear')) $('#selectedYear').value = y;
        setActiveView('tesouraria');
        loadTransactions(m, y);
      }));

      if ($('#annualEntradas')) $('#annualEntradas').innerText = totals.totalEntradas.toFixed(2);
      if ($('#annualRcc')) $('#annualRcc').innerText = totals.totalRcc.toFixed(2);
      if ($('#annualSaidas')) $('#annualSaidas').innerText = totals.totalSaidas.toFixed(2);
      if ($('#annualCaixa')) $('#annualCaixa').innerText = totals.totalCaixaExtra.toFixed(2);
      if ($('#annualSaldo')) {
        $('#annualSaldo').innerText = totals.lucroLiquido.toFixed(2);
        $('#annualSaldo').className = totals.lucroLiquido >= 0 ? 'text-green-600 text-2xl font-bold' : 'text-red-600 text-2xl font-bold';
      }
    } catch (error) {
      console.error('Erro ao gerar relatório anual:', error);
      toast('❌ Erro ao gerar relatório anual');
    } finally {
      setLoading(false);
    }
  }

  // ======= Loading States =======
  function setLoading(isLoading) {
    const body = document.body;
    if (isLoading) {
      body.classList.add('loading');
    } else {
      body.classList.remove('loading');
    }
  }

  // ======= Utility Functions =======
  function formatDate(dateStr) {
    try {
      if (!dateStr) return 'Data inválida';
      // Usa a função corrigida de parseamento
      const date = parseLocalDate(dateStr);
      return date.toLocaleDateString('pt-BR');
    } catch (error) {
      console.error('Erro ao formatar data:', error);
      return 'Data inválida';
    }
  }

  function toast(msg){
    try {
      $$('.toast').forEach(t => t.remove());
      const t = document.createElement('div');
      t.innerText = msg;
      t.className = 'toast';
      document.body.appendChild(t);
      setTimeout(()=> {
        if (t.parentNode) {
          t.style.animation = 'slideInRight 0.3s ease-out reverse';
          setTimeout(()=> { if (t.parentNode) t.remove(); }, 300);
        }
      }, 3000);
    } catch (error) {
      console.error('Erro ao exibir toast:', error);
    }
  }

  // ======= UI Bindings =======
  window.addEventListener('DOMContentLoaded', async () => {
    try {
      await ensurePresetMembersExist();

      // Navegação desktop e mobile
      $$('.nav-item, .mobile-nav-item').forEach(btn => btn.addEventListener('click', e => {
        const target = e.currentTarget.dataset.view;
        setActiveView(target);
      }));

      setActiveView('tesouraria');

      await loadTransactions(currentMonth, currentYear);
      await loadMembersAndContributions(currentMonth, currentYear);  
      await buildAnnualReport(currentYear);

      const txForm = $('#txForm');
      if (txForm) {
        txForm.addEventListener('submit', async e => {
          e.preventDefault();
          const type = $('#txType')?.value || 'entrada';
          const desc = $('#txDesc')?.value?.trim() || '';
          const val = $('#txValue')?.value || '0';
          const data = $('#txDate')?.value || formatDateForInput(new Date());
          
          if(!desc || !val || val === '0') return toast('❌ Preencha descrição e valor');
          if(!data) return toast('❌ Selecione uma data');
          
          await saveTransaction({ type, description: desc, value: val, date: data });
          
          // Reset form mas mantém a data atual
          $('#txDesc').value = '';
          $('#txValue').value = '';
          $('#txType').value = 'entrada';
          $('#txDate').value = formatDateForInput(new Date());
        });
      }

      // Event listeners para filtros
      const selectedMonth = $('#selectedMonth');
      if (selectedMonth) {
        selectedMonth.addEventListener('change', () => {
          const month = Number($('#selectedMonth')?.value || currentMonth);
          const year = Number($('#selectedYear')?.value || currentYear);
          loadTransactions(month, year);
        });
      }

      const selectedYear = $('#selectedYear');
      if (selectedYear) {
        selectedYear.addEventListener('change', () => {
          const month = Number($('#selectedMonth')?.value || currentMonth);
          const year = Number($('#selectedYear')?.value || currentYear);
          loadTransactions(month, year);
        });
      }

      const memberMonth = $('#memberMonth');
      if (memberMonth) {
        memberMonth.addEventListener('change', () => {
          const month = Number($('#memberMonth')?.value || currentMonth);
          const year = Number($('#memberYear')?.value || currentYear);
          loadMembersAndContributions(month, year);
        });
      }

      const memberYear = $('#memberYear');
      if (memberYear) {
        memberYear.addEventListener('change', () => {
          const month = Number($('#memberMonth')?.value || currentMonth);
          const year = Number($('#memberYear')?.value || currentYear);
          loadMembersAndContributions(month, year);
        });
      }

      const reportYearInput = $('#reportYearInput');
      if (reportYearInput) {
        reportYearInput.addEventListener('change', () => {
          const year = Number($('#reportYearInput')?.value || currentYear);
          buildAnnualReport(year);
        });
      }

      const btnAddMember = $('#btnAddMember');
      if (btnAddMember) {
        btnAddMember.addEventListener('click', () => {
          const name = $('#newMemberName')?.value || '';
          addMemberByName(name);
        });
      }

      const newMemberName = $('#newMemberName');
      if (newMemberName) {
        newMemberName.addEventListener('keypress', e => {
          if(e.key === 'Enter') {
            const name = $('#newMemberName')?.value || '';
            addMemberByName(name);
          }
        });
      }

      lucide.createIcons();
    } catch (error) {
      console.error('Erro ao inicializar aplicação:', error);
      toast('❌ Erro ao inicializar aplicação');
    }
  });
</script>

<div class="mobile-header">
  <div class="flex items-center gap-3">
    <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
      <i data-lucide="church" class="w-5 h-5"></i>
    </div>
    <h1 class="text-lg font-bold">Tesouraria - Grupo de Oração</h1>
  </div>
</div>

<div class="flex min-h-screen">
  <aside class="sidebar">
    <div class="logo-area">
      <div class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center mx-auto mb-3">
        <i data-lucide="church" class="w-7 h-7 text-white"></i>
      </div>
      <h1 class="text-xl font-bold text-gray-800">Tesouraria</h1>
      <p class="text-gray-600 text-sm">Grupo de Oração</p>
    </div>

    <nav class="flex-1">
      <div class="nav-item" data-view="tesouraria">
        <i data-lucide="wallet" class="w-5 h-5"></i>
        <span>Tesouraria</span>
      </div>
      <div class="nav-item" data-view="membros">
        <i data-lucide="users" class="w-5 h-5"></i>
        <span>Membros</span>
      </div>
      <div class="nav-item" data-view="contabilidade">
        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
        <span>Contabilidade</span>
      </div>
    </nav>
  </aside>

  <main class="flex-1 main-content p-8">
    <div id="views">

      <section id="tesouraria" class="hidden space-y-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
            <i data-lucide="wallet" class="w-6 h-6 text-white"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Tesouraria</h1>
            <p class="text-gray-600">Gerencie as finanças do grupo</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="stat-card stat-card-success">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-green-100 text-sm font-medium">Entradas</p>
                <p class="text-3xl font-bold">R$ <span id="totalEntradas">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="trending-up" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card stat-card-warning">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-yellow-100 text-sm font-medium">Saídas</p>
                <p class="text-3xl font-bold">R$ <span id="totalSaidas">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="trending-down" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-blue-100 text-sm font-medium">Saldo</p>
                <p class="text-3xl font-bold">R$ <span id="saldoAtual">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="piggy-bank" class="w-6 h-6"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="card-elegant p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="plus-circle" class="w-5 h-5 text-blue-600"></i>
            Nova Transação
          </h2>
          
          <form id="txForm" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
              <select id="txType" class="input-elegant">
                <option value="entrada">📈 Entrada</option>
                <option value="saida">📉 Saída</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Descrição *</label>
              <input id="txDesc" placeholder="Digite a descrição..." class="input-elegant" required />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$) *</label>
              <input id="txValue" type="number" placeholder="0,00" step="0.01" min="0.01" class="input-elegant" required />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Data *</label>
              <input id="txDate" type="date" class="input-elegant" required />
            </div>

            <div class="md:col-span-4">
              <button type="submit" class="btn-success w-full">
                <i data-lucide="save" class="w-4 h-4"></i>
                Salvar Transação
              </button>
            </div>
          </form>
        </div>

        <div class="card-elegant p-6">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
            <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-2">
              <i data-lucide="history" class="w-5 h-5 text-blue-600"></i>
              Histórico de Transações
            </h2>
            
            <div class="flex gap-3">
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Mês</label>
                <input id="selectedMonth" type="number" min="1" max="12" class="input-elegant w-20" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Ano</label>
                <input id="selectedYear" type="number" min="2023" max="2030" class="input-elegant w-24" />
              </div>
            </div>
          </div>
          
          <div class="table-elegant">
            <table class="w-full">
              <thead>
                <tr>
                  <th class="text-left">Data</th>
                  <th class="text-left">Tipo</th>
                  <th class="text-left">Descrição</th>
                  <th class="text-right">Valor</th>
                  <th class="text-center">Ação</th>
                </tr>
              </thead>
              <tbody id="transactionsList">
                <tr>
                  <td colspan="5" class="p-8 text-center text-gray-500">
                    <div class="flex flex-col items-center gap-2">
                      <i data-lucide="loading" class="w-8 h-8 text-gray-300 animate-spin"></i>
                      <div>Carregando transações...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="membros" class="hidden space-y-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-blue-600 rounded-xl flex items-center justify-center">
            <i data-lucide="users" class="w-6 h-6 text-white"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Membros</h1>
            <p class="text-gray-600">Gerencie membros e contribuições</p>
          </div>
        </div>

        <div class="card-elegant p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="user-plus" class="w-5 h-5 text-blue-600"></i>
            Adicionar Membro
          </h2>
          
          <div class="flex gap-4">
            <input id="newMemberName" placeholder="Nome do novo membro..." class="input-elegant flex-1" />
            <button id="btnAddMember" class="btn-primary">
              <i data-lucide="plus" class="w-4 h-4"></i>
              Adicionar
            </button>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="stat-card">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-blue-100 text-sm font-medium">Total de Membros</p>
                <p class="text-3xl font-bold"><span id="membersCount">0</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="users" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card stat-card-success">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-green-100 text-sm font-medium">Total RCC</p>
                <p class="text-3xl font-bold">R$ <span id="totalRcc">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="heart" class="w-6 h-6"></i>
              </div>
            </div>
          </div>

          <div class="stat-card stat-card-warning">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-yellow-100 text-sm font-medium">Caixa Extra</p>
                <p class="text-3xl font-bold">R$ <span id="totalCaixa">0.00</span></p>
              </div>
              <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <i data-lucide="gift" class="w-6 h-6"></i>
              </div>
            </div>
          </div>
        </div>

        <div class="card-elegant p-6">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
            <h2 class="text-xl font-semibold text-gray-900 flex items-center gap-2">
              <i data-lucide="list" class="w-5 h-5 text-blue-600"></i>
              Contribuições
            </h2>
            
            <div class="flex gap-3">
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Mês</label>
                <input id="memberMonth" type="number" min="1" max="12" class="input-elegant w-20" />
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">Ano</label>
                <input id="memberYear" type="number" min="2023" max="2030" class="input-elegant w-24" />
              </div>
            </div>
          </div>
          
          <div class="table-elegant">
            <table class="w-full">
              <thead>
                <tr>
                  <th class="text-left">Membro</th>
                  <th class="text-center">RCC (R$)</th>
                  <th class="text-center">Caixa Extra (R$)</th>
                  <th class="text-center">Ação</th>
                </tr>
              </thead>
              <tbody id="membersTableBody">
                <tr>
                  <td colspan="4" class="p-8 text-center text-gray-500">
                    <div class="flex flex-col items-center gap-2">
                      <i data-lucide="loading" class="w-8 h-8 text-gray-300 animate-spin"></i>
                      <div>Carregando membros...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="contabilidade" class="hidden space-y-8">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl flex items-center justify-center">
            <i data-lucide="bar-chart-3" class="w-6 h-6 text-white"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Contabilidade</h1>
            <p class="text-gray-600">Relatório anual consolidado</p>
          </div>
        </div>

        <div class="card-elegant p-6">
          <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
            <label class="text-sm font-medium text-gray-700">Ano do relatório:</label>
            <input id="reportYearInput" type="number" min="2023" max="2030" class="input-elegant w-24" />
            <span class="text-lg font-semibold text-gray-900">Relatório de <span id="reportYear">2025</span></span>
          </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
          <div class="card-elegant p-4 text-center">
            <div class="text-green-600 text-xl md:text-2xl font-bold">R$ <span id="annualEntradas">0.00</span></div>
            <div class="text-sm text-gray-600">Entradas</div>
          </div>
          <div class="card-elegant p-4 text-center">
            <div class="text-blue-600 text-xl md:text-2xl font-bold">R$ <span id="annualRcc">0.00</span></div>
            <div class="text-sm text-gray-600">RCC</div>
          </div>
          <div class="card-elegant p-4 text-center">
            <div class="text-red-600 text-xl md:text-2xl font-bold">R$ <span id="annualSaidas">0.00</span></div>
            <div class="text-sm text-gray-600">Saídas</div>
          </div>
          <div class="card-elegant p-4 text-center">
            <div class="text-yellow-600 text-xl md:text-2xl font-bold">R$ <span id="annualCaixa">0.00</span></div>
            <div class="text-sm text-gray-600">Caixa Extra</div>
          </div>
          <div class="card-elegant p-4 text-center col-span-2 md:col-span-1">
            <div class="text-xl md:text-2xl font-bold" id="annualSaldo">R$ 0.00</div>
            <div class="text-sm text-gray-600">Resultado</div>
          </div>
        </div>

        <div class="card-elegant p-6">
          <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center gap-2">
            <i data-lucide="calendar" class="w-5 h-5 text-blue-600"></i>
            Detalhamento Mensal
          </h2>
          
          <div class="table-elegant">
            <table class="w-full">
              <thead>
                <tr>
                  <th class="text-left">Mês</th>
                  <th class="text-right">Entradas</th>
                  <th class="text-right">RCC</th>
                  <th class="text-right">Saídas</th>
                  <th class="text-right">Caixa Extra</th>
                  <th class="text-right">Resultado</th>
                  <th class="text-right">Ação</th>
                </tr>
              </thead>
              <tbody id="reportTableBody">
                <tr>
                  <td colspan="7" class="p-8 text-center text-gray-500">
                    <div class="flex flex-col items-center gap-2">
                      <i data-lucide="loading" class="w-8 h-8 text-gray-300 animate-spin"></i>
                      <div>Carregando relatório...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

    </div>
  </main>
</div>

<!-- Mobile Navigation -->
<nav class="mobile-nav">
  <div class="mobile-nav-item" data-view="tesouraria">
    <i data-lucide="wallet" class="w-5 h-5"></i>
    <span>Tesouraria</span>
  </div>
  <div class="mobile-nav-item" data-view="membros">
    <i data-lucide="users" class="w-5 h-5"></i>
    <span>Membros</span>
  </div>
  <div class="mobile-nav-item" data-view="contabilidade">
    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
    <span>Relatórios</span>
  </div>
</nav>

<script>
  // Initialize form values with corrected date handling
  document.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    const currentMonth = today.getMonth() + 1;
    const currentYear = today.getFullYear();
    
    // Função para formatar data corretamente (mesma do JavaScript module)
    const formatDateForInput = (date) => {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    };
    
    const todayStr = formatDateForInput(today);
    
    const elements = [
      { id: 'txDate', value: todayStr },
      { id: 'selectedMonth', value: currentMonth },
      { id: 'selectedYear', value: currentYear },
      { id: 'memberMonth', value: currentMonth },
      { id: 'memberYear', value: currentYear },
      { id: 'reportYearInput', value: currentYear }
    ];
    
    elements.forEach(({ id, value }) => {
      const element = document.getElementById(id);
      if (element) element.value = value;
    });
  });
</script>

</body>
</html>
